---
title: "Example of using CreDating"
author: "Xavier Didelot"
date: "`r Sys.Date()`"
output: html_notebook
---

##Initialisation

```{r}
library(CreDating)
library(ape)
set.seed(0)
```

##Data

We consider a random timed tree with 20 leaves, with the root in 2000. 

```{r}
nsam <- 20
phy <- rtree(nsam, br = rexp)
phy$root.time <- 2000
plot(phy)
axisPhylo(backward = F)
```

We can extract the sampling dates.
```{r}
dates = leafDates(phy)
```

On each branch we observe a number of substitutions which is distributed $\mathrm{Poisson}(rl)$
where $l$ is the branch length and 
$r=10$ per year is the real substitution rate.
```{r}
obsphy=phy
obsphy$root.time=NULL
obsphy$edge.length=unlist(lapply(obsphy$edge.length*1,function (x) rpois(1,x)))
plot(obsphy)
axisPhylo(backward = F)
```

Let's do a root-to-tip regression analysis:

```{r}
res=roottotip(obsphy,dates)
```

##Analysis

We run CreDating as follows:

```{r}
res=credating(obsphy,dates,nbIts = 10000)
plot(res)
```
Plot with credibility bars:
```{r}
plot(res,'treeCI')
```


We can see what the MCMC traces look like:

```{r}
plot(res,'trace')
```
